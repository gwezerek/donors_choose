<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width">
	<title>Resource Priorities</title>
	<link rel="stylesheet" href="css/site.css">
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
</head>

<body>
		<article class="fc-graphic-article">
		<ul class="fc-decorative-border">
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
		</ul>
		<div class="fc-graphic-container">
			<h6 class="fc-graphic-overline">2008-2013</h6>
			<h4 class="fc-graphic-title">Resource Priorities</h4>
			<section class="fc-graphic-content-block">
				<h5 class="fc-graphic-subhed">In 
				<select class="fc-graphic-select" tabindex="-1">
					<option value="AL">Alabama</option>
					<option value="AK">Alaska</option>
					<option value="AZ">Arizona</option>
					<option value="AR">Arkansas</option>
					<option value="CA">California</option>
					<option value="CO">Colorado</option>
					<option value="CT">Connecticut</option>
					<option value="DE">Delaware</option>
					<option value="FL">Florida</option>
					<option value="GA">Georgia</option>
					<option value="HI">Hawaii</option>
					<option value="ID">Idaho</option>
					<option value="IL">Illinois</option>
					<option value="IN">Indiana</option>
					<option value="IA">Iowa</option>
					<option value="KS">Kansas</option>
					<option value="KY">Kentucky</option>
					<option value="LA">Louisiana</option>
					<option value="ME">Maine</option>
					<option value="MD">Maryland</option>
					<option value="MA">Massachusetts</option>
					<option value="MI">Michigan</option>
					<option value="MN">Minnesota</option>
					<option value="MS">Mississippi</option>
					<option value="MO">Missouri</option>
					<option value="MT">Montana</option>
					<option value="NE">Nebraska</option>
					<option value="NV">Nevada</option>
					<option value="NH">New Hampshire</option>
					<option value="NJ">New Jersey</option>
					<option value="NM">New Mexico</option>
					<option value="NY" selected>New York</option>
					<option value="NC">North Carolina</option>
					<option value="ND">North Dakota</option>
					<option value="OH">Ohio</option>
					<option value="OK">Oklahoma</option>
					<option value="OR">Oregon</option>
					<option value="PA">Pennsylvania</option>
					<option value="RI">Rhode Island</option>
					<option value="SC">South Carolina</option>
					<option value="SD">South Dakota</option>
					<option value="TN">Tennessee</option>
					<option value="TX">Texas</option>
					<option value="UT">Utah</option>
					<option value="VT">Vermont</option>
					<option value="VA">Virginia</option>
					<option value="WA">Washington</option>
					<option value="WV">West Virginia</option>
					<option value="WI">Wisconsin</option>
					<option value="WY">Wyoming</option>
		        </select>
				, donors funded:</h5>
				<ol class="fc-graphic-trend-list">
					<li class="fc-graphic-trend-item">88% of Applied Learning requests (1st of 50)</li>
					<li class="fc-graphic-trend-item">38% of Special Needs requests (49th of 50)</li>
				</ol>	
			</section>
			<section class="fc-graphic-content-block">
				<p class="fc-graphic-annotation fc-graphic-annotation-requests">Teachers requested 7,603 resources overall.</p>
				<div class="fc-stacked-bar">
				</div>
				<p class="fc-graphic-annotation fc-graphic-annotation-funded">Donors funded 74% of those requests.</p>
				<ol class="fc-graphic-legend">
					<li class="fc-graphic-legend-item">Literacy &amp; Language</li>
					<li class="fc-graphic-legend-item">Special Needs</li>
					<li class="fc-graphic-legend-item">Math &amp; Science</li>
					<li class="fc-graphic-legend-item">History &amp; Civics</li>
					<li class="fc-graphic-legend-item">Music &amp; Arts</li>
					<li class="fc-graphic-legend-item">Health &amp; Sports</li>
					<li class="fc-graphic-legend-item">Applied Learning</li>
					<li class="fc-graphic-legend-item">Insignificant Data</li>
				</ol>	
			</section>
			<section class="fc-graphic-content-block">
				<h5 class="fc-graphic-subhed">Explore the Extremes</h5>
				<ol class="fc-graphic-extremes-list">
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Most Funded Overall</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Least Resource Requests</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Most Resource Requests</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Least Funded Overall</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Most Funded Music &amp; Arts</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Least Funded History &amp; Civics</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Most Funded History &amp; Civics</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Least Funded Special Needs</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Most Funded Applied Learning</a></li>
				</ol>	
			</section>
			<span class="sources-copy"><span class="sources-leadin">SOURCE</span> Donors Choose</span>
		</div>

		<!-- D3 STACKED BAR LAYOUT -->
		<script>

			var firstState = $('select').val();
			var pageWidth = parseInt(d3.select('.fc-graphic-content-block').style('width')) - 15; // REVISIT AND GET THE RIGHT WIDTH

			var margin = {top: 0, right: 0, bottom:0, left: 0},
			    width = pageWidth - margin.left - margin.right,
			    height = 140;

			var x = d3.scale.linear()
			    .rangeRound([0, width]);

			var y = d3.scale.ordinal()
			    .rangeRoundBands([height, 0]);

			// Sets bar colors
			var color = d3.scale.ordinal()
			    .range([
			    	"#FFDF80",
					"#FFB581",
					"#FF8A80",
					"#FF81CB",
					"#DF81FF",
					"#9288FF",
					"#81A0FF",
				 ]);

			// Adds SVG element, append a container g element for each state
			var svg = d3.select(".fc-stacked-bar").append("svg")
			    .attr("width", width + margin.left + margin.right)
			    .attr("height", height + margin.top + margin.bottom)
			  .append("g")
			  	.attr("class", "state-container");

			// DAT DATA
			d3.tsv("requests.tsv", function(error, data) {
			  // Assigns the colors we set in the range to the columns of data
			  color.domain(d3.keys(data[0]).filter(function(key) { 
			  		return key !== "State";
			  }));

			  // COME BACK TO THIS
			  data.forEach(function(d) {
			    var x0 = 0;
			    // Creates a new sub-array in each d that holds the returned vals
			    d.categories = color.domain().map(function(name) { return {name: name, x0: x0, x1: x0 += +d[name]}; });
			    d.categories.forEach(function(d) { d.x0 /= x0; d.x1 /= x0; });
			  });

  			  data = data.filter(function(row) {
		        return row['State'] == firstState;
		      })

			  // Sorts data in ascending order by Literacy and Language %
			  // data.sort(function(a, b) { return b.categories[0].x1 - a.categories[0].x1; });

			  //Sets the domain for y equal to the series of U.S. States
			  // x.domain(data.map(function(d) { return d.State; }));

			  // Append the segments of each state's bars to the container g element
			  var requests = svg.selectAll(".state")
			      .data(data)
			    .enter().append("g")
			      .attr("class", "state")
			      .attr("transform", function(d) { return "translate(0," + x(d.State) + ")"; });

			  // Append the segments of each state's bars to the container g element
			  requests.selectAll("rect")
			      .data(function(d) { return d.categories; })
			    .enter().append("rect")
			      // Sets the x position 
			      .attr("x", function(d) { return x(d.x0); })
			      .attr("width", function(d) { return x(d.x0) + x(d.x1); })
			      .attr("height", "40")
			      .style("stroke", "white")
			      .style("fill", function(d) { return color(d.name); });

			});

			$('select').on('change', function() {
			  alert( this.value ); // or $(this).val()
			});

			</script>

	</article>

</body>

</html>
