<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width">
	<title>Resource Priorities</title>
	<link rel="stylesheet" href="css/site.css">
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
</head>

<body>
		<article class="fc-graphic-article">
		<ul class="fc-decorative-border">
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
			<li class="fc-decorative-border-box"></li>
		</ul>
		<div class="fc-graphic-container">
			<h6 class="fc-graphic-overline">2008-2013</h6>
			<h4 class="fc-graphic-title">Resource Priorities</h4>
			<section class="fc-graphic-content-block">
				<h5 class="fc-graphic-subhed">In <span class="fc-graphic-dropdown-wrapper">Alaska</span> donors funded:</h5>
				<ol class="fc-graphic-trend-list">
					<li class="fc-graphic-trend-item">74% of teachersâ€™ 7,603 requests (30th of 50)</li>
					<li class="fc-graphic-trend-item">88% of Applied Learning requests (1st of 50)</li>
					<li class="fc-graphic-trend-item">38% of Special Needs requests (49th of 50)</li>
				</ol>	
			</section>
			<section class="fc-graphic-content-block">
				<div class="fc-stacked-bar">
				</div>
				<ol class="fc-graphic-legend">
					<li class="fc-graphic-legend-item">Literacy &amp; Language</li>
					<li class="fc-graphic-legend-item">Special Needs</li>
					<li class="fc-graphic-legend-item">Math &amp; Science</li>
					<li class="fc-graphic-legend-item">History &amp; Civics</li>
					<li class="fc-graphic-legend-item">Music &amp; Arts</li>
					<li class="fc-graphic-legend-item">Health &amp; Sports</li>
					<li class="fc-graphic-legend-item">Applied Learning</li>
					<li class="fc-graphic-legend-item">Insignificant Data</li>
				</ol>	
			</section>
			<section class="fc-graphic-content-block">
				<h5 class="fc-graphic-subhed">Explore the Extremes</h5>
				<ol class="fc-graphic-extremes-list">
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Most Funded Overall</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Least Resource Requests</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Most Resource Requests</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Least Funded Overall</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Most Funded Music &amp; Arts</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Least Funded History &amp; Civics</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Most Funded History &amp; Civics</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Least Funded Special Needs</a></li>
					<li class="fc-graphic-extremes-item"><a href="#" class="fc-graphic-tag">Most Funded Applied Learning</a></li>
				</ol>	
			</section>
			<span class="sources-copy"><span class="sources-leadin">SOURCE</span> Donors Choose</span>
		</div>

		<!-- D3 STACKED BAR LAYOUT -->
		<script>

			var pageWidth = parseInt(d3.select('.fc-graphic-content-block').style('width')) - 15; // REVISIT AND GET THE RIGHT WIDTH

			var margin = {top: 20, right: 0, bottom: 30, left: 0},
			    width = pageWidth - margin.left - margin.right,
			    height = 320 - margin.top - margin.bottom;

			var x = d3.scale.ordinal()
			    .rangeRoundBands([0, width], .25);

			var y = d3.scale.linear()
			    .rangeRound([width, 0]);

			var color = d3.scale.ordinal()
			    .range([
			    	"#FFDF80",
					"#FFB581",
					"#FF8A80",
					"#FF81CB",
					"#DF81FF",
					"#9288FF",
					"#81A0FF",
				 ]);

			var svg = d3.select(".fc-stacked-bar").append("svg")
			    .attr("width", width + margin.left + margin.right)
			    .attr("height", height + margin.top + margin.bottom)
			  .append("g")
			    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			d3.tsv("requests.tsv", function(error, data) {
			  color.domain(d3.keys(data[0]).filter(function(key) { 
			  		return key !== "State";
			  }));

			  data.forEach(function(d) {
			    var y0 = 0;
			    d.categories = color.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name]}; });
			    d.categories.forEach(function(d) { d.y0 /= y0; d.y1 /= y0; });
			  });

			  data.sort(function(a, b) { return b.categories[0].y1 - a.categories[0].y1; });

			  x.domain(data.map(function(d) { return d.State; }));

			  var state = svg.selectAll(".state")
			      .data(data)
			    .enter().append("g")
			      .attr("class", "state")
			      .attr("transform", function(d) { return "translate(0," + x(d.State) + ")"; });

			  state.selectAll("rect")
			      .data(function(d) { return d.categories; })
			    .enter().append("rect")
			      .attr("width", x.rangeBand())
			      .attr("x", function(d) { return (width - y(d.y1) - (y(d.y0) - y(d.y1))); })
			      .attr("width", function(d) { return y(d.y0) - y(d.y1); })
			      .attr("height", "3")
			      .style("stroke", "white")
			      .style("fill", function(d) { return color(d.name); });

			});

			</script>

	</article>

</body>

</html>
